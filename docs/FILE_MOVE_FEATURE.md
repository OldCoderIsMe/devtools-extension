# 文件移动快捷指令功能评估

## 需求概述

在客户端快捷指令中实现文件操作功能：
- 清空目录A下的文件
- 复制目标B下所有文件到新目录中
- A、B支持配置本地长期保持配对
- 支持设置别名（例如 a2b）
- 快捷指令支持 `move a2b` 这样的命令

## 技术可行性评估

### ✅ 可行性：高

**原因：**
1. Electron 环境支持 Node.js 文件系统操作
2. 已有 IPC 通信机制
3. 已有设置存储机制（settings.js）
4. 已有快捷指令系统

### 技术实现要点

#### 1. 文件系统操作
- 使用 Node.js `fs` 模块
- 需要 `fs.promises` 进行异步操作
- 需要 `fs-extra` 或原生实现递归操作

#### 2. 安全性考虑
- ⚠️ **高风险操作**：文件删除和复制
- 需要用户确认机制
- 需要错误处理和回滚
- 建议添加操作日志

#### 3. 配置存储
- 使用现有的 `settings.js` 机制
- 存储路径配对和别名
- 路径验证和持久化

#### 4. IPC 通信
- 在 `preload.js` 中暴露文件操作 API
- 在 `main.js` 中实现文件操作逻辑
- 在 `commandParser.ts` 中添加命令解析

## 实现方案

### Phase 1: 配置管理

#### 1.1 扩展设置存储
在 `settings.js` 中添加路径配对配置：
```javascript
const DEFAULT_SETTINGS = {
  shortcuts: { ... },
  fileMovePairs: [
    {
      alias: 'a2b',
      sourcePath: '/path/to/source',
      targetPath: '/path/to/target',
      description: '描述信息'
    }
  ]
};
```

#### 1.2 设置界面
在 `SettingsPanel.vue` 中添加：
- 路径配对管理界面
- 添加/编辑/删除配对
- 路径选择器（使用 Electron 的 dialog）

### Phase 2: 文件操作实现

#### 2.1 IPC 处理
在 `main.js` 中添加：
```javascript
ipcMain.handle('file-move:execute', async (event, alias) => {
  // 1. 读取配置
  // 2. 验证路径
  // 3. 清空目标目录
  // 4. 复制源文件
  // 5. 返回结果
});
```

#### 2.2 文件操作逻辑
- 清空目录：删除目录下所有文件（保留目录结构）
- 复制文件：递归复制所有文件和子目录
- 错误处理：捕获异常并返回详细错误信息

### Phase 3: 快捷指令集成

#### 3.1 命令解析
在 `commandParser.ts` 中添加：
```typescript
case 'move':
  // 解析别名
  // 调用 IPC
  // 返回结果
```

#### 3.2 命令格式
- `move a2b` - 执行别名 a2b 的文件移动操作
- `move list` - 列出所有配置的配对
- `move add a2b /path/to/source /path/to/target` - 添加配对（可选）

## 安全措施

### 1. 用户确认
- 首次执行需要确认
- 显示操作预览（将要删除和复制的文件列表）
- 支持 `--force` 参数跳过确认

### 2. 路径验证
- 验证路径是否存在
- 验证路径是否在允许范围内（可选：白名单）
- 防止路径遍历攻击

### 3. 错误处理
- 详细的错误信息
- 操作日志记录
- 失败时回滚（可选）

### 4. 权限控制
- 仅在 Electron 环境中可用
- 不暴露给浏览器环境
- 需要用户明确授权

## 实现复杂度

- **配置管理**：中等（2-3小时）
- **文件操作**：中等（3-4小时）
- **快捷指令集成**：简单（1-2小时）
- **安全措施**：中等（2-3小时）
- **测试和优化**：中等（2-3小时）

**总计**：约 10-15 小时

## 建议

### ✅ 推荐实现

**理由：**
1. 功能实用，提高开发效率
2. 技术实现可行
3. 符合工具定位

### 实现建议

1. **分阶段实现**：
   - 先实现基础功能（清空+复制）
   - 再添加安全措施和优化

2. **用户体验**：
   - 添加操作进度提示
   - 显示操作结果统计
   - 支持撤销操作（可选）

3. **扩展性**：
   - 支持更多操作（移动、同步等）
   - 支持条件过滤（文件类型、大小等）
   - 支持定时任务（可选）

## 风险提示

1. **数据安全**：文件删除不可逆，需要谨慎
2. **性能影响**：大文件或大量文件可能耗时较长
3. **跨平台兼容**：路径格式在不同系统可能不同
4. **权限问题**：某些目录可能需要管理员权限

## 结论

**建议实现**，但需要：
1. 充分的安全措施
2. 清晰的用户提示
3. 完善的错误处理
4. 详细的文档说明

